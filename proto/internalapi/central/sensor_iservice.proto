syntax = "proto3";

option go_package = "central";

import "internalapi/central/cluster_config.proto";
import "internalapi/central/cluster_status.proto";
import "internalapi/central/network_flow.proto";
import "internalapi/central/sensor_events.proto";

package central;

message ReprocessDeployments {
    message AllTarget  {}
    message RiskTarget {}

    repeated string deployment_ids = 1;
    oneof Target {
        AllTarget  all   = 2;
        RiskTarget risk  = 3;
    }

}

message MsgFromSensor {
    oneof msg {
        SensorEvent                  event                           = 1;
        NetworkFlowUpdate            network_flow_update             = 2;
        ScrapeUpdate                 scrape_update                   = 3;
        NetworkPoliciesResponse      network_policies_response       = 4;
        ClusterStatusUpdate          cluster_status_update           = 5;
        ReprocessDeployments         reprocess_deployments           = 6;
    }
}

message MsgToSensor {
    oneof msg {
        SensorEnforcement            enforcement                    = 1;
        ScrapeCommand                scrape_command                 = 2;
        NetworkPoliciesCommand       network_policies_command       = 3;
        ClusterConfig                cluster_config                 = 4;
    }
}

service SensorService {

    rpc Communicate(stream MsgFromSensor) returns (stream MsgToSensor);

}
