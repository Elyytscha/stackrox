tests:
- name: "IPS are not created with allowNone=true"
  expect: |
    .secrets["secured-cluster-services-main"] | assertThat(. == null)
    .secrets["secured-cluster-services-collector"] | assertThat(. == null)
- name: "IPS are created with username and password specified"
  values:
    imagePullSecrets:
      username: foo
      password: bar
  expect: |
    .secrets["secured-cluster-services-main"] | assertThat(. != null)
    .secrets["secured-cluster-services-collector"] | assertThat(. != null)
- name: "IPS are created with empty password"
  values:
    imagePullSecrets:
      username: foo
      password: ""
  expect: |
    .secrets["secured-cluster-services-main"] | assertThat(. != null)
    .secrets["secured-cluster-services-collector"] | assertThat(. != null)
- name: "default IPS are referenced in service accounts"
  expect: |
    .serviceaccounts["collector"] | .imagePullSecrets[] | select(.name == "stackrox")
    .serviceaccounts["collector"] | .imagePullSecrets[] | select(.name == "stackrox")
    .serviceaccounts["collector"] | .imagePullSecrets[] | select(.name == "stackrox-collector")
    .serviceaccounts["sensor"] | .imagePullSecrets[] | select(.name == "stackrox")
    [.serviceaccounts["sensor"] | .imagePullSecrets[] | select(.name == "stackrox-collector")] | assertThat(length == 0)
    .serviceaccounts["admission-control"] | .imagePullSecrets[] | select(.name == "stackrox")
    [.serviceaccounts["admission-control"] | .imagePullSecrets[] | select(.name == "stackrox-collector")] | assertThat(length == 0)
- name: "additional IPS are referenced in service accounts"
  values:
    imagePullSecrets:
      useExisting: custom-ips
  expect: |
    .serviceaccounts["collector"] | .imagePullSecrets[] | select(.name == "custom-ips")
    .serviceaccounts["sensor"] | .imagePullSecrets[] | select(.name == "custom-ips")
    .serviceaccounts["admission-control"] | .imagePullSecrets[] | select(.name == "custom-ips")
