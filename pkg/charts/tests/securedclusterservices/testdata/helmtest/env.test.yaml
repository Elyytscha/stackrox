server:
  availableSchemas:
  - openshift-4.1.0
tests:
- name: "OpenShift resources should be created"
  expect: |
    .securitycontextconstraints.sensor != null
    .securitycontextconstraints.collector != null
    .securitycontextconstraints["admission-control"] != null
    envVars(.deployments.sensor; "sensor")["ROX_OPENSHIFT_API"] == "true"
  tests:
  - name: "on an OpenShift server"
    server:
      visibleSchemas:
      - openshift-4.1.0
    expect: |
      .notes | assertThat(contains("we have inferred that you are deploying into an OpenShift cluster"))
  - name: "with env.openshift=true"
    set:
      env.openshift: true
    expect: |
      .notes | assertThat(contains("we have inferred that you are deploying into an OpenShift cluster") | not)

- name: "OpenShift resources should not be created"
  expect: |
    .securitycontextconstraints == null
    envVars(.deployments.sensor; "sensor")["ROX_OPENSHIFT_API"] != "true"
  tests:
  - name: "on a non-OpenShift server"
  - name: "with env.openshift=false"
    server:
      visibleSchemas:
      - openshift-4.1.0
    set:
      env.openshift: false
